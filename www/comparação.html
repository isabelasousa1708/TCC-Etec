<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="js/index.js"></script>
    <link rel="stylesheet" href="css/home.css">
    <title>Document</title>
</head>
<body>
    <img src="img/WhatsApp Video 2021-06-14 at 17.26.22.mp4" alt="" srcset="">
    <button id="compare" onclick="compare()">comparar</button>

    <form id="upload-form" action="" method="POST" enctype="multipart/form-data">
        <label class="btn-upload">
            <input type="file" id="file" name="file" name="submit">
            <button class="btn"><img src="img/galleryIcon.png" ></button>
        </label>
        <label class="bnt-action">
            <input type="submit" id="action" >
            <button class="btn-action"><img src="img/actionIcon.png"></button>
        </label>
     </form>   

     <div id="gallery">
        <!---->
     </div>

     <script type="text/javascript">
        const CLIENT_ID ="0f6ee2b06618621";
        const gallery = document.getElementById('gallery');

         const doUpload = (url, options) =>{
             console.dir(options);
             const promiseCallback = (resolve, reject) =>{
                    fetch(url, options)
                    .then(response => response.json())
                    .then(resolve)
                    .catch(reject);
            };
            return new Promise (promiseCallback);
        } 
        
        const addImage = (url) =>{
            gallery.innerHTML = `<img src="${url}" width="150" id="image"/>`;
        }

        const onSuccess = (result) => {

             const {data: {link} } = result;
             console.log('link', link);
             window.link = link;
             addImage(link);

        };

        const uploadImage = (e) => {
             e.preventDefault();//nao faz submit
             const file = document.getElementById('file');
             //pegar o arquivo submetido com data
             const data = new FormData();//
             data.append('image', file.files[0]);
             
             
             //fazer o upload.
             doUpload('https://api.imgur.com/3/image',{
                method: 'POST',
                body: data,
                headers: {
                    'Authorization':`Client-ID ${CLIENT_ID}`,
                }
            })
            .then(onSuccess)
            .catch(console.error);
         };  
        const form = document.getElementById('upload-form');//pegando o form pelo ID
            form.addEventListener('submit',uploadImage); //form submitado       
    </script>
</body>
</html>